<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Copenhell 2026 ‚Äî Band Anbefaler</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root{--red:#c0392b;--black:#0a0a0a;--dark:#111;--mid:#1a1a1a;--text:#e8e8e8;--muted:#666;--green:#1DB954;}
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--black);color:var(--text);font-family:'Oswald',sans-serif;min-height:100vh;padding:40px 16px 80px;}
  body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(192,57,43,0.02) 2px,rgba(192,57,43,0.02) 4px);pointer-events:none;z-index:0;}
  .wrap{max-width:700px;margin:0 auto;position:relative;z-index:1;}
  header{text-align:center;margin-bottom:40px;}
  .logo{font-size:clamp(40px,10vw,64px);font-weight:700;color:var(--red);letter-spacing:6px;text-shadow:0 0 40px rgba(192,57,43,0.4);animation:flicker 6s infinite;}
  @keyframes flicker{0%,94%,100%{opacity:1}95%{opacity:.7}96%{opacity:1}97%{opacity:.5}98%{opacity:1}}
  .tagline{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:4px;margin-top:6px;text-transform:uppercase;}
  .rule{height:1px;background:linear-gradient(90deg,transparent,var(--red),transparent);margin:20px auto;max-width:500px;}
  .card{background:var(--dark);border:1px solid #1e1e1e;border-top:2px solid var(--red);padding:28px;margin-bottom:16px;}
  .card-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--red);letter-spacing:3px;text-transform:uppercase;margin-bottom:16px;}
  .desc{font-size:15px;font-weight:300;color:#bbb;line-height:1.6;margin-bottom:22px;}
  .inputs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:18px;}
  @media(max-width:500px){.inputs{grid-template-columns:1fr;}}
  .inp-wrap{position:relative;}
  .inp-num{position:absolute;top:10px;left:10px;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--red);pointer-events:none;}
  .band-input{width:100%;background:var(--mid);border:1px solid #333;border-bottom:2px solid #333;color:var(--text);font-family:'Oswald',sans-serif;font-size:16px;padding:10px 10px 10px 30px;outline:none;transition:border-color .2s;}
  .band-input:focus{border-color:var(--red);border-bottom-color:var(--red);}
  .band-input::placeholder{color:#3a3a3a;}
  .btn-submit{width:100%;background:var(--red);border:none;color:#fff;font-family:'Oswald',sans-serif;font-size:18px;font-weight:700;letter-spacing:3px;text-transform:uppercase;padding:16px;cursor:pointer;transition:background .2s;}
  .btn-submit:hover{background:#a93226;}
  .btn-submit:disabled{background:#333;cursor:not-allowed;}
  .err-box{display:none;margin-top:12px;padding:12px 16px;background:rgba(192,57,43,.1);border:1px solid var(--red);font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--red);}
  #loading{display:none;text-align:center;padding:60px 0;}
  .skull{font-size:56px;display:inline-block;animation:bang .25s ease-in-out infinite alternate;}
  @keyframes bang{from{transform:rotate(-12deg) translateY(0);}to{transform:rotate(12deg) translateY(-10px);}}
  .load-txt{font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--muted);letter-spacing:2px;margin-top:18px;animation:blink 1.4s ease-in-out infinite;}
  .load-sub{font-family:'Share Tech Mono',monospace;font-size:10px;color:#333;letter-spacing:1px;margin-top:8px;}
  @keyframes blink{0%,100%{opacity:.3}50%{opacity:1}}
  #results{display:none;}
  .res-header{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--red);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;}
  .res-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:#444;margin-bottom:20px;}
  .band-card{background:var(--dark);border:1px solid #1e1e1e;border-left:3px solid var(--red);padding:22px;margin-bottom:10px;opacity:0;transform:translateX(-16px);transition:opacity .4s,transform .4s;position:relative;}
  .band-card.show{opacity:1;transform:translateX(0);}
  .prio-badge{position:absolute;top:16px;right:16px;font-family:'Share Tech Mono',monospace;font-size:11px;color:#333;}
  .prio-badge span{color:var(--red);}
  .band-name{font-size:22px;font-weight:700;color:var(--red);letter-spacing:2px;margin-bottom:4px;padding-right:40px;}
  .band-hype{font-size:13px;color:#ddd;font-style:italic;border-left:2px solid var(--red);padding-left:10px;margin-bottom:10px;}
  .band-reason{font-size:14px;font-weight:300;color:#bbb;line-height:1.7;margin-bottom:14px;}
  .spotify-btn{display:inline-block;background:var(--green);color:#000;font-family:'Oswald',sans-serif;font-size:13px;font-weight:700;letter-spacing:1px;padding:6px 16px;border-radius:20px;text-decoration:none;transition:opacity .2s;}
  .spotify-btn:hover{opacity:.85;}
  .btn-reset{margin-top:24px;background:transparent;border:1px solid #2a2a2a;color:var(--muted);font-family:'Oswald',sans-serif;font-size:14px;letter-spacing:2px;padding:10px 24px;cursor:pointer;text-transform:uppercase;transition:border-color .2s,color .2s;}
  .btn-reset:hover{border-color:var(--red);color:var(--text);}
  .lineup-status{font-family:'Share Tech Mono',monospace;font-size:10px;color:#333;text-align:center;margin-bottom:16px;letter-spacing:1px;}
  .powered{font-family:'Share Tech Mono',monospace;font-size:10px;color:#2a2a2a;text-align:center;margin-top:40px;letter-spacing:2px;}
  .powered a{color:#333;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">COPENHELL</div>
    <div class="tagline">2026 ¬∑ AI Band Anbefaler</div>
    <div class="rule"></div>
  </header>

  <div class="lineup-status" id="lineupStatus">// Henter lineup...</div>

  <div class="card" id="inputCard">
    <div class="card-label">// Dine 3 favoritbands</div>
    <p class="desc">Indtast dine absolutte yndlingsbands ‚Äî AI'en finder de 10 bedste match fra det aktuelle Copenhell 2026 lineup i prioriteret r√¶kkef√∏lge. Gratis, ingen konto kr√¶vet.</p>
    <div class="inputs">
      <div class="inp-wrap"><span class="inp-num">01</span><input class="band-input" id="b1" type="text" placeholder="fx Metallica" /></div>
      <div class="inp-wrap"><span class="inp-num">02</span><input class="band-input" id="b2" type="text" placeholder="fx AC/DC" /></div>
      <div class="inp-wrap"><span class="inp-num">03</span><input class="band-input" id="b3" type="text" placeholder="fx Slipknot" /></div>
    </div>
    <button class="btn-submit" id="submitBtn" onclick="getRecommendations()">ü§ò Find mine Copenhell-bands</button>
    <div class="err-box" id="errBox"></div>
  </div>

  <div id="loading">
    <div class="skull">üíÄ</div>
    <div class="load-txt">AI analyserer din musiksmag...</div>
    <div class="load-sub" id="loadSub"></div>
  </div>

  <div id="results">
    <div class="res-header">// Dine 10 anbefalinger ‚Äî prioriteret r√¶kkef√∏lge</div>
    <div class="res-sub" id="resSub"></div>
    <div id="cardContainer"></div>
    <button class="btn-reset" onclick="reset()">‚Üê Pr√∏v igen</button>
  </div>

  <div class="powered">Powered by <a href="https://pollinations.ai" target="_blank">Pollinations.ai</a></div>
</div>

<script>
const FALLBACK_LINEUP = [
  "Iron Maiden","Bring Me The Horizon","Volbeat","Twisted Sister","Alice Cooper",
  "Papa Roach","A Perfect Circle","Trivium","Anthrax","Sepultura","The Pretty Reckless",
  "P.O.D.","Kublai Khan TX","President","Tom Morello","Mastodon","Social Distortion",
  "Bury Tomorrow","Paleface Swiss","All Them Witches","Mammoth","Loathe","Dogma",
  "Slay Squad","Calva Louise","Lightchapter","Haandgemeng","Henret","Scimitar",
  "Babymetal","Black Label Society","Suicidal Tendencies","Imminence","Soilwork",
  "Djerv","Eyehategod","Faetooth","Unpeople","Maceration","Morild","Pustulant Flesh",
  "Rap Martin Rap","Alestorm","Ice Nine Kills","Gaerea","Black Oak County",
  "Queensryche","Static-X","Defecto","Six Feet Under","Konvent","Iotunn",
  "Die Spitz","Thrown","Trollfest","Katla","Neckbreakker","Omsorg","Blood Fire Death",
  "Gridiron","Split","Twenty One Children","Chopper","Violent Magic Orchestra",
  "End It","Malevolence","Inhuman Nature","Vexed","Powerplant","Psycho Mosher"
];

let currentLineup = [...FALLBACK_LINEUP];

async function fetchLineup() {
  const statusEl = document.getElementById('lineupStatus');
  try {
    const proxy = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://copenhell.dk/en/category/copenhell-2026-en/');
    const resp = await fetch(proxy, { signal: AbortSignal.timeout(8000) });
    const data = await resp.json();
    const html = data.contents || '';
    const SKIP = new Set(['COPENHELL','NEW','BANDS','THE','AND','FOR','WITH','FROM',
      'MORE','ALL','STAGE','TICKETS','FESTIVAL','READ','JUNE','JULY','AUGUST',
      'HTTP','HTML','MENU','SKIP','MAIN','HERE','THIS','THEIR','THEY','WHEN',
      'WHAT','HAVE','BEEN','WILL','YOUR','ALSO','THAT','THESE','THOSE','IRON']);
    const matches = [...html.matchAll(/\b([A-Z][A-Z0-9 &.\-']{1,35}[A-Z0-9])\b/g)]
      .map(m => m[1].trim()).filter(n => n.length > 2 && !SKIP.has(n));
    const unique = [...new Set(matches)];
    if (unique.length > 15) {
      currentLineup = unique;
      statusEl.textContent = '// Lineup hentet live: ' + unique.length + ' bands';
      statusEl.style.color = '#1DB954';
    } else { throw new Error('too few'); }
  } catch(e) {
    currentLineup = FALLBACK_LINEUP;
    statusEl.textContent = '// Cached lineup: ' + FALLBACK_LINEUP.length + ' bands';
    statusEl.style.color = '#555';
  }
}
fetchLineup();

function showErr(msg) {
  const el = document.getElementById('errBox');
  el.textContent = '// ' + msg;
  el.style.display = 'block';
}

async function getRecommendations() {
  const b1 = document.getElementById('b1').value.trim();
  const b2 = document.getElementById('b2').value.trim();
  const b3 = document.getElementById('b3').value.trim();
  if (!b1 || !b2 || !b3) { showErr('Udfyld alle 3 favoritbands.'); return; }

  document.getElementById('inputCard').style.display = 'none';
  document.getElementById('loading').style.display = 'block';
  document.getElementById('errBox').style.display = 'none';
  document.getElementById('loadSub').textContent = 'Analyserer ' + currentLineup.length + ' bands...';

  const systemMsg = 'Du er en metal-ekspert. Svar KUN med valid JSON uden markdown eller forklaring udenfor JSON.';
  const userMsg = `En bruger elsker: "${b1}", "${b2}", "${b3}".

Copenhell 2026 lineup: ${currentLineup.join(', ')}

Vaelg de 10 bedste bands fra lineuppet baseret paa brugerens musiksmag. Sorter i prioriteret raekkefoelge, bedste match foerst (priority 1 = bedste).

Returner JSON i dette format:
{"recommendations":[{"name":"praecist bandnavn fra lineup","hype":"fed saelgende saetning paa dansk max 10 ord","reason":"2-3 saetninger paa dansk om hvorfor bandet matcher smagen med specifikke referencer til de 3 favoritbands","priority":1}]}`;

  try {
    // Brug den korrekte POST endpoint med json=true som query parameter
    const resp = await fetch('https://text.pollinations.ai/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'mistral',
        json: true,
        messages: [
          { role: 'system', content: systemMsg },
          { role: 'user',   content: userMsg }
        ]
      }),
      signal: AbortSignal.timeout(30000)
    });

    if (!resp.ok) {
      const errText = await resp.text();
      throw new Error('API fejl ' + resp.status + ': ' + errText.slice(0,100));
    }

    const text = await resp.text();
    let json;
    // Parse svaret - Pollinations kan returnere flere formater
    let raw = text.trim();
    let extracted = '';
    try {
      const parsed = JSON.parse(raw);
      // Format 1: OpenAI choices-array
      if (parsed.choices && parsed.choices[0]) {
        extracted = parsed.choices[0].message?.content || '';
      }
      // Format 2: Direkte message-objekt { role, content, reasoning_content }
      else if (parsed.role === 'assistant') {
        extracted = parsed.content || parsed.reasoning_content || '';
        // Hvis content er tomt, kan hele recommendations-arrayet v√¶re i parsed direkte
        if (!extracted && parsed.recommendations) {
          json = parsed;
        }
      }
      // Format 3: Direkte JSON med recommendations
      else if (parsed.recommendations) {
        json = parsed;
      }
      else {
        extracted = raw;
      }
    } catch(e) {
      extracted = raw;
    }

    if (!json && extracted) {
      extracted = extracted.replace(/```json|```/g,'').trim();
      try {
        json = JSON.parse(extracted);
      } catch(e) {
        const m = extracted.match(/\{[\s\S]*\}/);
        if (m) {
          try { json = JSON.parse(m[0]); } catch(e2) {
            throw new Error('Parse fejl. Svar: ' + extracted.slice(0,150));
          }
        } else {
          throw new Error('Intet JSON fundet. Svar: ' + extracted.slice(0,150));
        }
      }
    }

    if (!json.recommendations || json.recommendations.length === 0)
      throw new Error('Ingen anbefalinger i svaret ‚Äî pr√∏v igen');

    json.recommendations.sort((a,b) => (a.priority||99) - (b.priority||99));
    showResults(json.recommendations.slice(0,10), b1, b2, b3);

  } catch(e) {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('inputCard').style.display = 'block';
    showErr(e.message);
  }
}

function showResults(recs, b1, b2, b3) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('results').style.display = 'block';
  document.getElementById('resSub').textContent =
    'Baseret paa: ' + b1.toUpperCase() + ' ¬∑ ' + b2.toUpperCase() + ' ¬∑ ' + b3.toUpperCase();
  const container = document.getElementById('cardContainer');
  container.innerHTML = '';
  recs.forEach((rec, i) => {
    const card = document.createElement('div');
    card.className = 'band-card';
    card.innerHTML =
      '<div class="prio-badge">#<span>' + (rec.priority||i+1) + '</span></div>' +
      '<div class="band-name">' + rec.name.toUpperCase() + '</div>' +
      '<div class="band-hype">' + rec.hype + '</div>' +
      '<div class="band-reason">' + rec.reason + '</div>' +
      '<a class="spotify-btn" href="https://open.spotify.com/search/' + encodeURIComponent(rec.name) + '" target="_blank">‚ñ∂ Spotify</a>';
    container.appendChild(card);
    setTimeout(() => card.classList.add('show'), i * 120 + 50);
  });
}

function reset() {
  document.getElementById('results').style.display = 'none';
  document.getElementById('inputCard').style.display = 'block';
  document.getElementById('cardContainer').innerHTML = '';
  ['b1','b2','b3'].forEach(id => document.getElementById(id).value = '');
}
document.addEventListener('keydown', e => { if (e.key === 'Enter') getRecommendations(); });
</script>
</body>
</html>
